<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Weather Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background: linear-gradient(135deg,#36d1dc,#5b86e5);
      color: #fff;
      min-height:100vh;
    }
    .card { background: rgba(255,255,255,0.08); }
    .big { font-size: 48px; font-weight:700; }
  </style>
</head>
<body>
  <div class="container py-5">
    <div class="text-center mb-4">
      <h1 class="big">üå§Ô∏è Weather Dashboard</h1>
      <p>Live weather and 7-day forecast</p>
    </div>

    <form method="get" class="row g-2 justify-content-center mb-4">
      <div class="col-md-6">
        <input name="city" class="form-control" placeholder="Enter city (e.g., Singapore, Bengaluru)" value="{{ city }}">
      </div>
      <div class="col-auto">
        <button class="btn btn-light">Search</button>
      </div>
    </form>

    {% if error %}
      <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    {% if current %}
    <div class="row gy-3">
      <div class="col-md-4">
        <div class="card p-3">
          <h5>Current in {{ current.name }}</h5>
          <p class="display-6">{{ current.main.temp }} ¬∞C</p>
          <p>{{ current.weather[0].description.title() }}</p>
        </div>
      </div>

      <div class="col-md-8">
        <div class="card p-3">
          <canvas id="forecastChart" height="120"></canvas>
        </div>
      </div>
    </div>

    <script>
      const forecast = {{ forecast.daily[:7] | tojson }};
      const labels = forecast.map(d => {
        const dt = new Date(d.dt * 1000);
        return dt.toLocaleDateString();
      });
      const temps = forecast.map(d => d.temp.day);
      const ctx = document.getElementById('forecastChart').getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Daily temp (¬∞C)',
            data: temps,
            fill: true,
            tension: 0.3,
            borderWidth: 2
          }]
        },
        options: { responsive: true }
      });
    </script>
    {% endif %}
  </div>
</body>
</html>